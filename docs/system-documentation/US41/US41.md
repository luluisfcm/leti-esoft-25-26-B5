# US 41 - Record the administration of a vaccine

## 1. Requirements Engineering

### 1.1. User Story Description
As a Nurse, I want to record the administration of a vaccine to an SNS user.

### 1.2. Customer Specifications and Clarifications

**From the specifications document:**

> The nurse should select a vaccine and the administered lot number. The SNS user should be assigned to the recovery room.

**From the client clarifications:**

> **Question:** No VaccinationRecord temos o atributo da administeredDate que surge a partir do appointment previamente feito pelo SNSUser ou Rececionista. Uma vez que este atributo não é nem TypedData nem SelectedData uma vez que já vem implicitamente da US21 ou US31 (US's respetivas à marcação) , como devemos interpretar este dado na US41? Um dado que será implicitamente gerido pelo sistema e automaticamente "colocado" no VaccinationRecord tendo em conta o appointment do SNSUser?

> **Answer:** A data pode ser obtida automaticamente a partir do sistema. No entanto, a hora deve ser registada manualmente, de forma a refletir o momento exato em que a vacina foi efetivamente administrada, uma vez que pode ser diferente da hora inicialmente agendada.

> **Question:** Nesta US, no VaccinationRecord temos o atributo de adverseReaction. É referido como uma das AC's desta US que o user deve ser movido para a recovery room após a administração da vacina, onde aguarda (30min) para verificar se ocorre alguma reação adversa.
A questão é como devemos interpretar em que altura a enfermeira preenche o VaccinationRecord se no fim deste tempo de espera do SNSUser na recovery room, podendo-o fazer de uma vez só sendo que já terá toda a informação necessária. Ou se este é preenchida a dois tempos, isto é, após o user ser administrado a vacina e movido para a recovery room (com os dados da vacina o lote e a data) e só depois do tempo determinado de repouso na recovery room verificar se ocurreu alguma reação adversa (necessitando de uma atualização (update) no VaccinationRecord).

> **Answer:** Na US41, apenas é registada a administração da vacina. O registo de reações adversas será tratado numa User Story distinta.
### 1.3. Acceptance Criteria

-  **AC41-1:** The nurse should select a vaccine and the administered lot number. 
-  **AC41-2:** The SNS user should be assigned to the recovery room. 

### 1.4. Found out Dependencies

-  **UC04 - Register Arrival / Check-in:** The SNS user must have their arrival recorded to be available for vaccine administration. 
-  **UC12 - Manage Vaccine Types & Brands:** Vaccine types and brands must be previously defined in the system for the nurse to select them. 
-  **UC02 - Schedule Vaccination Appointment:** An appointment is required to link the vaccination event and update the user's status. 

### 1.5 Input and Output Data

**Input Data:**

- **Selected data:**
    -  SNS User (from the list of checked-in users). 
    -  Vaccine (the specific brand being administered). 
- **Typed data:**
    -  Lot number (the alphanumeric code of the vaccine lot). 

**Output Data:**

-  Success or failure of the operation. 
-  Confirmation that the user was assigned to the recovery room state. 
### 1.6. System Sequence Diagram (SSD)

![US41-SSD](svg/US41-SSD.svg)

**Note:** The system requests the SNS user, the vaccine, and the lot number. After confirmation, it informs the nurse that the user was assigned to the recovery room.

## 2. OO Analysis

### 2.1. Relevant Domain Model Excerpt

![US41-MD](svg/US41-MD.svg)

**Key entities involved:**
-  **Nurse:** The staff member responsible for administering the vaccine.
-  **SNSUser:** The person receiving the vaccine.
-  **Appointment:** Represents the scheduled event where the status is updated (e.g., to "InRecovery").
-  **VaccinationEvent:** Records the specific details like lot number and administration time.
-  **Vaccine:** The brand and technology used in the administration.


## 3. Design - User Story Realization

### 3.1. Rationale

| Interaction ID | The System... (from SSD) | Entity | Responsibility |
|:--------------|:-------------------------|:-------|:---------------|
| **Step 1** | asks to record a vaccine administration | Nurse (Actor) | Initiates the process. |
| **Step 2** | shows vaccines list and requests data | RecordVaccinationView | Interface with the Nurse. |
| | | VaccineRepository | Provide registered vaccines. |
| | | VaccineDTO | Protect domain (DTO Pattern). |
| **Step 3** | provides requested data | RecordVaccinationController | Receive and hold input data. |
| | | VaccinationService | Coordinate validation and creation. |
| **Step 4** | shows all data and requests confirmation | RecordVaccinationView | Display data for review. |
| | | VaccinationEvent | Hold administration details. |
| **Step 5** | confirms the data | VaccinationService | Coordinate saving and status update. |
| | | VaccinationEventRepository | Persist the administration record. |
| | | **Appointment** | **Information Expert**: Updates status. |
| | | AppointmentRepository | Persist updated appointment state. |
| **Step 6** | informs success and recovery transition | RecordVaccinationView | Provide success feedback. |
### Systematization

According to the taken rationale, the conceptual classes promoted to software classes are:

-  Nurse 
-  VaccinationEvent 
-  Appointment 
-  Vaccine 

Other software classes (i.e. Pure Fabrication) identified:

- RecordVaccinationView
- RecordVaccinationController
- VaccinationService
- VaccinationEventRepository
- AppointmentRepository
-  RepositoryFactory 

### 3.2. Sequence Diagram (SD)

![US41-SD](svg/US41-SD.svg)

### 3.3. Class Diagram (CD)

![US41-CD](svg/US41-CD.svg)

## 4. Tests

n/a

## 5. Construction (Implementation)

-  The implementation follows the Service and Repository patterns established in the project baseline.
-  Data persistence is handled via In-Memory Repositories for this sprint.

## 6. Integration and Demo

- A new menu option was added to the Nurse's console interface to trigger the `RecordVaccinationView`.
-  The system now links the `VaccinationEvent` directly to the user's `Appointment`.

## 7. Observations

-  The assignment to the recovery room is a logical state change, ensuring the system can track which users are currently under observation.
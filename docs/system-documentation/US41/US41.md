# US 41 - Record the administration of a vaccine

## 1. Requirements Engineering

### 1.1. User Story Description
As a Nurse, I want to record the administration of a vaccine to an SNS user.

### 1.2. Customer Specifications and Clarifications

**From the specifications document:**

> The nurse should select a vaccine and the administered lot number. The SNS user should be assigned to the recovery room.

**From the client clarifications:**

> Question: How is the recovery room handled if it's not a physical entity in the initial DM? Answer: It should be handled as a logical state change in the Appointment status (e.g., transition to "InRecovery").

### 1.3. Acceptance Criteria

- [cite_start]**AC41-1:** The nurse should select a vaccine and the administered lot number. [cite: 5, 6]
- [cite_start]**AC41-2:** The SNS user should be assigned to the recovery room. [cite: 5, 6]

### 1.4. Found out Dependencies

- [cite_start]**UC04 - Register Arrival / Check-in:** The SNS user must have their arrival recorded to be available for vaccine administration. [cite: 5]
- [cite_start]**UC12 - Manage Vaccine Types & Brands:** Vaccine types and brands must be previously defined in the system for the nurse to select them. [cite: 5, 6]
- [cite_start]**UC02 - Schedule Vaccination Appointment:** An appointment is required to link the vaccination event and update the user's status. [cite: 5]

### 1.5 Input and Output Data

**Input Data:**

- **Selected data:**
    - [cite_start]SNS User (from the list of checked-in users). [cite: 5]
    - [cite_start]Vaccine (the specific brand being administered). [cite: 3, 5]
- **Typed data:**
    - [cite_start]Lot number (the alphanumeric code of the vaccine lot). [cite: 3, 5]

**Output Data:**

- [cite_start]Success or failure of the operation. [cite: 15]
- [cite_start]Confirmation that the user was assigned to the recovery room state. [cite: 5]
### 1.6. System Sequence Diagram (SSD)

![US41-SSD](svg/US41-SSD.svg)

**Note:** The system requests the SNS user, the vaccine, and the lot number. After confirmation, it informs the nurse that the user was assigned to the recovery room.

## 2. OO Analysis

### 2.1. Relevant Domain Model Excerpt

![US41-MD](svg/US41-MD.svg)

**Key entities involved:**
- [cite_start]**Nurse:** The staff member responsible for administering the vaccine[cite: 3].
- [cite_start]**SNSUser:** The person receiving the vaccine[cite: 1].
- [cite_start]**Appointment:** Represents the scheduled event where the status is updated (e.g., to "InRecovery")[cite: 3].
- [cite_start]**VaccinationEvent:** Records the specific details like lot number and administration time[cite: 3].
- [cite_start]**Vaccine:** The brand and technology used in the administration[cite: 2].


## 3. Design - User Story Realization

### 3.1. Rationale

| Interaction ID | The System... | Entity | Responsibility |
|:--------------|:--------------|:-------|:---------------|
| Step 1 | Requests data (SNS user, vaccine, lot) | RecordVaccinationView | [cite_start]Interface with the Nurse [cite: 5, 7] |
| Step 2 | Gets the list of available vaccines | VaccineRepository | [cite_start]Provide all registered vaccines [cite: 1, 12] |
| Step 3 | Creates the vaccination event | VaccinationService | [cite_start]Coordinate the creation of the event [cite: 12] |
| Step 4 | Updates the appointment status | Appointment | [cite_start]Logical change to "InRecovery" [cite: 3] |
| Step 5 | Persists the new event | VaccinationEventRepository | [cite_start]Save the administration record [cite: 1, 12] |

### Systematization

According to the taken rationale, the conceptual classes promoted to software classes are:

- [cite_start]Nurse [cite: 1, 5]
- [cite_start]VaccinationEvent [cite: 1, 5]
- [cite_start]Appointment [cite: 1, 3]
- [cite_start]Vaccine [cite: 1, 2]

Other software classes (i.e. Pure Fabrication) identified:

- RecordVaccinationView
- RecordVaccinationController
- VaccinationService
- VaccinationEventRepository
- AppointmentRepository
- [cite_start]RepositoryFactory [cite: 12]

### 3.2. Sequence Diagram (SD)

![US41-SD](svg/US41-SD.svg)

### 3.3. Class Diagram (CD)

![US41-CD](svg/US41-CD.svg)

## 4. Tests

[cite_start]**Test 1:** Check that the Appointment status transitions to "InRecovery" (or "Vaccinated") after a successful record[cite: 3].

[cite_start]**Test 2:** Check that a VaccinationEvent cannot be created with an empty lot number[cite: 3].

[cite_start]**Test 3:** Check that the Vaccine selected exists in the system's registry[cite: 2].

## 5. Construction (Implementation)

- [cite_start]The implementation follows the Service and Repository patterns established in the project baseline[cite: 12, 14].
- [cite_start]Data persistence is handled via In-Memory Repositories for this sprint[cite: 12].

## 6. Integration and Demo

- A new menu option was added to the Nurse's console interface to trigger the `RecordVaccinationView`.
- [cite_start]The system now links the `VaccinationEvent` directly to the user's `Appointment`[cite: 1, 3].

## 7. Observations

- [cite_start]The assignment to the recovery room is a logical state change, ensuring the system can track which users are currently under observation[cite: 3].
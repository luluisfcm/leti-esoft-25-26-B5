@startuml
title CD â€“ US41 Record Vaccine Administration (Updated with DTO)

hide circle
skinparam classAttributeIconSize 0

' ===================== UI & Controller =====================
class RecordVaccinationView {
}

class RecordVaccinationController {
    + getVaccinesList(): List<VaccineDTO>
    + recordVaccination(snsUserNum, lotNumber, vaccineBrand): void
    + saveVaccinationEvent(): Result
}

' ===================== Actor & Service =====================
class Nurse {
    - name
    + getVaccinationService(): VaccinationService
}

class VaccinationService {
    + VaccinationService(eventRepo, appRepo, vacRepo)
    + getVaccinesDTO(): List<VaccineDTO>
    + createVaccinationEvent(snsUserNum, lotNumber, vaccineBrand): void
    + saveEvent(): Result
    + assignToRecoveryRoom(snsUserNum): void
}

' ===================== DTO =====================
class VaccineDTO {
    - brand : String
    - commercialName : String
    + VaccineDTO(brand, name)
}

' ===================== Interfaces (Persistence) =====================
interface VaccinationEventRepository <<interface>> {
    + save(VaccinationEvent event): Result
}

interface AppointmentRepository <<interface>> {
    + findActiveBySNSUser(snsUserNum): Appointment
    + save(Appointment app): Result
}

interface VaccineRepository <<interface>> {
    + findAll(): List<Vaccine>
}

interface RepositoryFactory <<interface>> {
    + getVaccinationEventRepository(): VaccinationEventRepository
    + getAppointmentRepository(): AppointmentRepository
    + getVaccineRepository(): VaccineRepository
}

' ===================== Entities =====================
class VaccinationEvent {
    - lotNumber : String
    - administrationDateTime : DateTime
    + VaccinationEvent(snsUser, lot, vaccine)
}

class Appointment {
    - status : AppointmentStatus
    - arrivalDateTime : DateTime
    + setStatus(status): void
}

class Vaccine {
    - commercialName : String
    - brand : String
    - technologyUsed : String
}

' ===================== Relationships =====================
' UI and Logic layer
RecordVaccinationView ..> RecordVaccinationController
RecordVaccinationController ..> Nurse
RecordVaccinationController ..> VaccinationService
RecordVaccinationController ..> VaccineDTO
Nurse -> VaccinationService: adopts

' Service and Domain layer
VaccinationService ..> VaccinationEventRepository
VaccinationService ..> AppointmentRepository
VaccinationService ..> VaccineRepository
VaccinationService ..> VaccinationEvent
VaccinationService ..> Appointment
VaccinationService ..> VaccineDTO

' Factory and Repositories
Nurse "1" -down-> "1" RepositoryFactory: uses
VaccinationEventRepository "1" -right-> "0..*" VaccinationEvent: records
RepositoryFactory ..> VaccinationEventRepository
RepositoryFactory ..> AppointmentRepository
RepositoryFactory ..> VaccineRepository

' Entity relationship from DM
Appointment "1" -right-> "0..1" VaccinationEvent : results in
VaccinationEvent "0..*" --> "1" Vaccine : of
@enduml
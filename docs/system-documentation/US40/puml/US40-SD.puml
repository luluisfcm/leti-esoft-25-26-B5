@startuml
autoactivate on
autonumber

title US40 - SD

actor "Nurse" as NurseActor
participant ":ConsultWaitingRoomView" as UI
participant ":ConsultWaitingRoomController" as Ctrl
participant ":Nurse" as Nurse
participant "service:CheckInService" as Service
participant "factory:RepositoryFactory" as Factory
participant "repo:CheckInRepository" as Repo
participant "dto:WaitingRoomDTO" as DTO

activate NurseActor

NurseActor -> UI: asks to consult the waiting room list
UI --> NurseActor: requests the selection of the vaccination center

NurseActor -> UI: selects the requested vaccination center
UI -> Ctrl: getWaitingRoomList(center)

' Obtenção do serviço via Nurse/Factory
Ctrl -> Nurse: getCheckInService()
Nurse -> Factory : getCheckInRepository()
Factory --> Nurse: repo
Nurse --> Service**: create(repo)
Nurse --> Ctrl: service

' Obtenção da lista e conversão para DTO no Serviço
Ctrl -> Service: getWaitingRoomList(center)
note right: AC40-1: Logic to sort by arrival time (FIFO)
Service -> Repo: findByCenter(center)
Repo --> Service: list<CheckIn>

loop for each checkIn in list
    Service -> DTO**: create(name, snsNumber, arrivalTime)
    note right: Extracts name and snsNumber from SNSUser entity
end

Service --> Ctrl: list<WaitingRoomDTO>
deactivate Service

Ctrl --> UI: list<WaitingRoomDTO>
deactivate Ctrl

' Exibição dos dados simplificados
UI --> NurseActor: displays the waiting list (Name, SNS Number, Arrival Time)
deactivate UI

@enduml
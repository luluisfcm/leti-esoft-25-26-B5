# US40 - As Nurse, I intend to consult the users in the waiting room of a vaccination center.

## 1. Requirements Engineering

### 1.1. User Story Description
As Nurse, I intend to consult the users in the waiting room of a vaccination center. 

### 1.2. Customer Specifications and Clarifications

**From the specifications document:**

>  When the SNS user arrives at the vaccination center, a receptionist registers their arrival.

**From the client clarifications:**

### 1.3. Acceptance Criteria

- **AC40-1:** The list of SNS users should be presented on a first-come, first-served basis.

### 1.4. Found out Dependencies

- The waiting room consultation depends on the Receptionist having previously registered the user's arrival in the system.
- The user must be authenticated with the "Nurse" profile.

### 1.5 Input and Output Data

**Input Data:**

* **Selected data:**
    * Vaccination Center (identification of the center where the nurse is working).

**Output Data:**
* List of SNS Users in the waiting room (Name and Arrival Time).
* (In)success message if the list is empty.

### 1.6. System Sequence Diagram (SSD)

![USXX-SSD](svg/US40-SSD.svg)

### 1.7 Other Relevant Remarks
This functionality is crucial for the workflow of the vaccination process, as it serves as the bridge between the reception/check-in and the actual vaccine administration. 

## 2. Analysis

### 2.1. Relevant Domain Model Excerpt

![USXX-DM](svg/US40-DM.svg)

### 2.2. Other Remarks

- The waiting room is a dynamic view of appointments that have changed status to "Arrived". 
- The system must ensure that the privacy of SNS users is respected, showing only necessary identification for the call. 

## 3. Design - User Story Realization

### 3.1. Rationale

| Interaction ID | Question: Which class is responsible for... | Answer | Justification (with patterns) |
|:---|:---|:---|:---|
| **Step 1** | ... interacting with the actor? | `ConsultationView` | Pure Fabrication: Handles user interaction. |
| | ... coordinating the US? | `ConsultationController` | Controller: Manages the flow and delegates tasks to services. |
| **Step 2** | ... providing the waiting list? | `WaitingRoomService` | Service: Contains the business logic for filtering and sorting. |
| **Step 3** | ... retrieving data from persistence? | `AppointmentRepository` | Repository: Accesses the stored appointments. |
| **Step 4** | ... ensuring order (FIFO)? | `WaitingRoomService` | Information Expert: Applies AC40-1 using arrivalDateTime. |
| **Step 5** | ... transferring data to UI? | `WaitingRoomDto` | DTO: Transports user data without exposing domain entities. |

### Systematization

Software classes identified:

- ConsultationView (View)
- ConsultationController (Controller)
- WaitingRoomService (Service)
- AppointmentRepository (Repository)
- WaitingRoomDto (DTO)
- RepositoryFactory (Factory)
- Appointment (Domain Entity)
- SNSUser (Domain Entity)

### 3.2. Sequence Diagram (SD)

![USXX-DM](svg/US20-SD.svg)


### 3.3. Class Diagram (CD)

![USXX-DM](svg/US20-CD.svg)


## 4. Tests

**Test 1:** Ensure the list is sorted by arrival time (FIFO).
**Test 2:** Ensure only users with "Arrived" status are shown.
**Test 3:** Ensure the system handles an empty waiting room gracefully.

## 5. Construction (Implementation)

n/a

## 6. Integration and Demo

n/a

## 7. Observations

The sorting logic is centralized in the `WaitingRoomService` to allow for future changes in priority rules (e.g., elderly priority) without affecting the UI or Repository layers.
@startuml
'https://plantuml.com/class-diagram

hide circle
skinparam classAttributeIconSize 0

class ScheduleVaccineView {
}

class ScheduleVaccineController {
    +getInitialData(): Result
    +buildPreview(request: ScheduleVaccineRequest): Result
    +schedule(request: ScheduleVaccineRequest): Result
}

class SNSUser {
    - name
    +getRepositoryFactory(): RepositoryFactory
}

class AppointmentService {
    +AppointmentService(repoFactory: RepositoryFactory)
    +getVaccineTypes(): List<VaccineType>
    +getCentersFor(type: VaccineType): List<VaccinationCenter>
    +getAvailableTimes(center: VaccinationCenter, type: VaccineType): List<Time>
    +buildPreview(request: ScheduleVaccineRequest): SchedulePreviewDTO
    +schedule(request: ScheduleVaccineRequest): Result
}

interface RepositoryFactory <<interface>> {
    +getAppointmentRepository(): AppointmentRepository
    +getVaccineTypeRepository(): VaccineTypeRepository
    +getVaccinationCenterRepository(): VaccinationCenterRepository
}

interface AppointmentRepository <<interface>> {
    +findFutureAppointmentsByUserAndType(userId, type): List<Appointment>
    +isSlotAvailable(center, date, time): boolean
    +save(app: Appointment): Result
}

interface VaccineTypeRepository <<interface>> {
    +getAll(): List<VaccineType>
    +getById(id): VaccineType
}

interface VaccinationCenterRepository <<interface>> {
    +getAll(): List<VaccinationCenter>
    +getById(id): VaccinationCenter
}

class Appointment {
    - date
    - time
    - status
    +changeStatus(...): Result
}

class VaccineType {
    - disease
    - shortDescription
}

class VaccinationCenter {
    - name
    - postalAddress
}

class ScheduleVaccineRequest {
    - snsUserId
    - vaccineTypeId
    - centerId
    - date
    - time
    - contactInfo
}

class SchedulePreviewDTO {
}

SNSUser "1" -down-> "1" RepositoryFactory: uses
AppointmentRepository "1" -right-> "0..*" Appointment: records

ScheduleVaccineView ..> ScheduleVaccineController
ScheduleVaccineController ..> SNSUser
ScheduleVaccineController ..> AppointmentService
ScheduleVaccineController ..> Appointment

AppointmentService ..> RepositoryFactory
RepositoryFactory .right.> AppointmentRepository
RepositoryFactory .right.> VaccineTypeRepository
RepositoryFactory .right.> VaccinationCenterRepository

AppointmentService ..> ScheduleVaccineRequest
AppointmentService ..> SchedulePreviewDTO

@enduml
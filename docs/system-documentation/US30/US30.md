# US30 - register a vaccine

## 1. Requirements Engineering

### 1.1. User Story Description

As SNS user, I intend to use the application to schedule a vaccine administration.

### 1.2. Customer Specifications and Clarifications

**From the specifications document:**

The system must allow an authenticated SNS user to schedule a vaccine administration.  
To schedule a vaccine administration, the SNS user must:

- Select a **vaccine type** from the existing vaccine types registered in the system.
- Select a **vaccination center** that provides the chosen vaccine type.
- Choose an available **date and time slot** for the administration in that center.
- Confirm the appointment details before final submission.

The system must ensure that the selected time slot is still available and that the SNS user meets any eligibility requirements associated with the chosen vaccine type.

**From the client clarifications:**

> **Question:** How are available time slots presented to the user?  
> **Answer:** The application must show **only valid and available time slots** previously configured for the chosen vaccination center and vaccine type.

> **Question:** In presencial scheduling, must the receptionist login as the SNS user or use their own staff account?  
> **Answer:** The receptionist uses their **own staff profile** to perform the scheduling, selecting the SNS user for whom the appointment is being created. The use case remains conceptually initiated by the SNS user.

> **Question:** Can a vaccine appointment be scheduled without logging in?  
> **Answer:** No. An authenticated profile is required — either an SNS user scheduling for themselves or a receptionist scheduling on behalf of an SNS user.

### 1.3. Acceptance Criteria

- **AC30-1:** Only authenticated SNS users may access the scheduling functionality.
- **AC30-2:** The SNS user must select a vaccine type from those already registered in the system.
- **AC30-3:** The chosen vaccination center must be one that provides the selected vaccine type.
- **AC30-4:** The SNS user must choose a date/time slot from those available for the selected center and vaccine type.
- **AC30-5:** All mandatory fields (vaccine type, center, date/time slot, and required personal/contact information) must be provided.
- **AC30-7:** Upon successful scheduling, the system must display a confirmation message containing at least: appointment ID, vaccine type, vaccination center, and scheduled date/time.
- **AC30-8:** If the appointment cannot be created (e.g., slot unavailable, validation error), the system must present an error message and must not create the appointment.
- 
### 1.4. Found Out Dependencies

- The list of **VaccineTypes** must already exist in the system so that the SNS user can select one when scheduling.
- The list of **VaccinationCenters**, including the mapping of which centers provide which vaccine types, must be pre-configured and available.
- The **available time slots** for each vaccination center and vaccine type must be previously defined in the system.
- The SNS user must be **authenticated** before accessing the scheduling functionality.
- Receptionists must be able to authenticate with a staff profile and select the SNS user for whom the appointment is being scheduled.

### 1.5 Input and Output Data

**Input Data:**

- **Typed data:**
  - Contact or confirmation details required for the appointment (e.g., phone number or email)

- **Selected data:**
  - Vaccine Type (chosen from existing registered VaccineTypes)
  - Vaccination Center (chosen from centers offering the selected vaccine type)
  - Date and Time Slot (chosen from the list of available slots for the selected center and vaccine type)

**Output Data:**

- Confirmation message with appointment details (in case of success)
- Error message indicating the reason the appointment could not be scheduled (in case of failure)

### 1.6. System Sequence Diagram (SSD)

![US30-SSD](svg/US30-SSD.svg)

### 1.7 Other Relevant Remarks

- In presencial support scenarios, the receptionist performs the scheduling using a staff profile but always on behalf of an SNS user.
- The specific vaccine administered is determined later by the vaccination center; during scheduling, only the vaccine type is selected.
- Time slot availability may change due to simultaneous scheduling operations by other users or staff.

## 2. Analysis

### 2.1. Relevant Domain Model Excerpt

The following excerpt of the Domain Model represents the concepts required to support the registration of a vaccine:

![US30-DM](svg/US30-DM.svg)

**Explanation:**

- **SNSUser**  
  Represents the citizen who receives the vaccination. Each `VaccineAppointment` must be associated with one SNS user.

- **Receptionist**  
  Represents staff who may schedule an appointment on behalf of an SNS user during presencial support. A `VaccineAppointment` may optionally reference a receptionist (`scheduledBy`).

- **VaccineType**  
  Represents the category of vaccine (e.g., COVID-19, Influenza). Each `VaccineAppointment` refers to exactly one `VaccineType`.

- **VaccinationCenter**  
  Represents the facility where the vaccination will occur. Each `VaccineAppointment` must be associated with one center.

- **VaccineAppointment**  
  Represents a scheduled vaccination for a citizen. It records the `dateTime`, `status`, and links to the SNS user, vaccine type, center, and optionally the receptionist.

- **Associations**  
  A `VaccineAppointment` belongs to one SNS user (`forUser`), refers to one vaccine type (`ofType`), occurs at one center (`atCenter`), and may be scheduled by a receptionist (`scheduledBy`).

### 2.2. Other Remarks

- The Domain Model does not explicitly represent time-slot availability. This is treated as application logic and validated during scheduling, not as a domain entity.
- The association with `Receptionist` is optional and only applies in presencial support scenarios; it does not alter the fundamental ownership of the appointment, which always belongs to the SNS user.
- No additional analysis artifacts (e.g., activity diagrams or state machines) were deemed necessary for this User Story.

## 3.1. Rationale

**The rationale grounds on the SSD interactions and the identified input/output data.**

| Interaction ID | Question: Which class is responsible for…                                                   | Answer                               | Justification (with patterns)                                                                                              |
|:--------------:|:---------------------------------------------------------------------------------------------|:-------------------------------------|:---------------------------------------------------------------------------------------------------------------------------|
| Step 1         | interacting with the actor (SNS User)?                                                       | ScheduleVaccineView                  | **Pure Fabrication** for UI interaction; isolates UI from domain logic.                                                    |
|                | receiving the system operation `requestScheduleVaccine()`?                                   | ScheduleVaccineController            | **GRASP Controller**: first object to receive input for this use case.                                                     |
|                | coordinating the execution of the US?                                                        | ScheduleVaccineController            | **Controller**: centralizes workflow orchestration.                                                                        |
| Step 2         | obtaining the list of available VaccineTypes?                                                | VaccineTypeRepository                | **Information Expert**: stores and retrieves VaccineType entities.                                                         |
| Step 3         | obtaining the list of VaccinationCenters for a given VaccineType?                            | VaccinationCenterRepository          | **Information Expert**: holds data about centers and available vaccine types.                                              |
| Step 4         | collecting user-selected data for scheduling?                                                | ScheduleVaccineRequest (DTO)         | **Pure Fabrication**: aggregates scheduling data into a single parameter object (**Parameter Object pattern**).            |
|                | validating input data (type, center, date/time)?                                             | ScheduleService                      | **Information Expert**: owns scheduling rules and validation logic.                                                        |
|                | obtaining available time slots for a given center and vaccine type?                          | ScheduleService                      | **Information Expert**: encapsulates availability logic.                                                                   |
| Step 5         | preparing appointment preview data?                                                          | ScheduleService                      | **Information Expert**: has all required data to assemble preview information.                                             |
| Step 6         | validating global constraint: user cannot have a future appointment of same type (AC30-6)?   | ScheduleService                      | **Information Expert**: manages and queries appointment rules.                                                             |
|                | verifying slot availability at confirmation time?                                            | ScheduleService                      | **Information Expert** for business rules.                                                                                 |
|                | creating a new `VaccineAppointment` instance?                                                | ScheduleService                      | **Creator**: receives the necessary data to instantiate the appointment.                                                   |
|                | persisting the appointment?                                                                  | VaccineAppointmentRepository         | **Pure Fabrication**: encapsulates storage and retrieval of appointments.                                                  |
| Step 7         | determining whether the scheduling succeeded or failed?                                      | ScheduleService                      | **Information Expert**: executes final validation and applies business constraints.                                        |
| Step 8         | informing the user of scheduling success or error?                                           | ScheduleVaccineView                  | **Pure Fabrication**: responsible for providing user feedback.                                                             |

### Systematization

According to the taken rationale, the conceptual classes promoted to software classes are:

- SNSUser
- Receptionist
- VaccineType
- VaccinationCenter
- VaccineAppointment

Other software classes (i.e., Pure Fabrication or GRASP-motivated) identified:

- ScheduleVaccineView
- ScheduleVaccineController
- ScheduleService
- VaccineTypeRepository
- VaccinationCenterRepository
- VaccineAppointmentRepository

DTOs / parameter objects introduced for data handling:

- ScheduleVaccineRequest
- SchedulePreviewDTO (optional)

### 3.2. Sequence Diagram (SD)

The following sequence diagram represents the dynamic view of the main software objects involved in the realization of this User Story.

![US30-SD](svg/US11-SD.svg)

### 3.3. Class Diagram (CD)

The following class diagram represents the main software classes involved in the realization of this User Story, as well as their relations, attributes and main methods.

![US30-CD](svg/US30-CD.svg)

## 4. Tests
n/a

## 5. Construction (Implementation)
n/a

## 6. Integration and Demo
n/a

## 7. Observations
n/a
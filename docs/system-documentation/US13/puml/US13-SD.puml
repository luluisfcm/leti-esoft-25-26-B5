@startuml
title US13 - Sequence Diagram
autoactivate on
autonumber

actor "DGS Administrator" as Admin
participant ":RegisterVaccinationCenterView" as UI
participant ":RegisterVaccinationCenterController" as Ctrl
participant ":DGSAdministrator" as ObjAdmin
participant "service:VaccinationCenterService" as Service
participant "repoVaccines:VaccineTypeRepository" as RepoVaccine
participant "repoCenters:VaccinationCenterRepository" as RepoCenter
participant "dto:VaccinationCenterDto" as Dto
participant "center:VaccinationCenter" as Center

activate Admin
Admin -> UI: asks to register a vaccination center
UI -> Ctrl: getVaccineTypes()
Ctrl -> ObjAdmin: getVaccinationCenterService()
ObjAdmin --> Ctrl: service
Ctrl -> Service: getVaccineTypes()
Service -> RepoVaccine: getAll()
RepoVaccine --> Service: List<VaccineType>
Service --> Ctrl: List<VaccineType>
Ctrl --> UI: List<VaccineType>
UI --> Admin: requests data & vaccine types

Admin -> UI: submits data
UI -> Dto**: create(...)
UI -> Ctrl: registerVaccinationCenter(dto)
Ctrl -> Service: register(dto)

' Correção do Loop: obter a lista antes de iterar
Service -> Dto: getVaccineTypeIds()
Dto --> Service: listIds
loop for each id in listIds
    Service -> RepoVaccine: getById(id)
    RepoVaccine --> Service: vaccineType
end

Service -> Center**: create(dto, vaccineTypes)
Service -> Service: validate(center)
Service -> RepoCenter: save(center)
RepoCenter --> Service: result
Service --> Ctrl: result
Ctrl --> UI: result
UI --> Admin: informs success
@enduml